/**
 * LiveStreet
 *
 * @license   GNU General Public License, version 2
 * @copyright 2013 OOO "ЛС-СОФТ" {@link http://livestreetcms.com}
 * @author    Denis Shakhov <denis.shakhov@gmail.com>
 */

tinymce.PluginManager.add('livestreet', function(editor, url) {
    // Заголовки
    ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].forEach(function(name) {
        editor.addButton('ls-' + name, {
            text: name.toUpperCase(),
            onclick: function() {
                editor.execCommand('mceToggleFormat', false, name);
            },
            onPostRender: function() {
                var self = this, setup = function() {
                    editor.formatter.formatChanged(name, function(state) {
                        self.active(state);
                    });
                };
                editor.formatter ? setup() : editor.on('init', setup);
            }
        });
    });

    // Ссылка на пользователя
    editor.addButton('ls-user', {
        icon: 'emoticons',
        tooltip: 'User',
        onclick: function() {
            // Open window
            editor.windowManager.open({
                title: 'Add user',
                body: [
                    { type: 'textbox', name: 'login', label: 'Login' }
                ],
                onsubmit: function(e) {
                    editor.insertContent('<lsuser>' + e.data.login + '</lsuser>');
                }
            });
        }
    });

    // Вставка медиа-объектов
    editor.addButton('ls-media', {
        icon: 'image',
        tooltip: 'Insert media',
        onclick: function() {
            $( editor.getElement() ).lsEditor( 'showMedia' );
        }
    });
});